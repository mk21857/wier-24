import{_ as t}from"./f141f5a29b.js";import{F as e,r,g as s,N as i,L as o}from"./825e28468d.js";import{r as a,a as m,b as n}from"./a25cff1b3a.js";import{L as h,N as l}from"./6f583b2759.js";import{e as p}from"./510f0914a3.js";import"./2be7671a02.js";import"./a20b5a7092.js";import"./eae60494e1.js";class F extends e{render(t,e){"response"===t&&(this.$el.innerHTML=e),"loading"===t&&this.$el.classList.toggle("is-fetching",e)}fetchStart(){this.setState({loading:!0})}fetchEnd(){this.setState({loading:!1})}}class f extends e{static el=".FormFilterChanger";static childrenEl={filterBlock:".FormFilterChanger-filterBlock",form:".FormFilterChanger-form",formData:".FormFilterChanger-formData"};static defaultProps={filterFormFetcher:null,namespace:"",showLoadingProgress:!0};constructor(t){super(t),this.entityListFilter=null,this.visible=!1,this.formElements=[],this.filterFormFetcher=null,this.initializeLoadingProgress(),this.props.formEl&&(this.$form="string"==typeof this.props.formEl?document.querySelector(this.props.formEl):this.props.formEl),this.addSubview(new F({el:this.$formData}),"formData"),(async()=>{await this.initializeFormElements(),this.props.onFilterFormFetcherReady?.()})()}async initializeFormElements(){this.entityListFilter=this.props.entityListFilterFactory();const t=this;"string"==typeof this.props.additionalElementsToSerialize?document.querySelector(this.props.additionalElementsToSerialize):this.props.additionalElementsToSerialize;const e=await a(this.props.namespace);this.formElements=[[this.entityListFilter],r(s(`${this.props.namespace}FilterFormFetcher`).map((t=>({...t,categoryType:this.filterFormCategoryType,elToSerialize:[this.$form,this.$additionalElementsToSerialize],fetchFormRequestUrl:this.props.fetchFormRequestUrl,beforeFetchFormMarkup:()=>{this.setState({loading:!0}),this.getSubview("formData")?.fetchStart(),this.props.beforeFetchFormMarkup?.()},onFetchFormMarkup:async t=>{await this.removeFormElements();const{response:e,bootData:r}=this.transformResponse(t);this.getSubview("formData")?.setState({response:e}),r.filter((({name:t})=>t.includes(`${this.props.namespace}FilterFormFetcher`))).forEach((({name:t,values:e})=>{i(t,e)})),await m(this.props.namespace,r),await this.initializeFormElements(),this.setState({loading:!1}),this.getSubview("formData")?.fetchEnd(),this.props.onFetchFormMarkup?.(r)},failedFetchFormMarkup:()=>{this.filterFormFetcher.fetchFormMarkup(0,this.filterFormFetcher.getFormData()),this.props.failedFetchFormMarkup?.()},onFetchNextCategory:t=>{t.isEmpty?this.filterFormCategoryType=h:this.filterFormCategoryType=l}}))),(function(e){return t.filterFormFetcher=new t.props.filterFormFetcher(e),t.filterFormFetcher})),e].flat()}async removeFormElements(){this.formElements.forEach((t=>{t.remove()})),this.formElements=[],await n(this.props.namespace),o(`${this.props.namespace}FilterFormFetcher`),this.filterFormFetcher=null}async initializeLoadingProgress(){if(!this.props.showLoadingProgress)return;const{default:e}=await t((()=>import("./adae24d060.js")),["adae24d060.js","544149bc29.js","a20b5a7092.js"]);this.removeSideEffect("progress"),this.addSideEffect((()=>(this.progress=e({parent:".FormFilterChanger-formData"}),()=>{this.progress?.destroy()})),"progress")}render(t,e){"loading"===t&&(e?this.progress?.start():this.progress?.done())}transformResponse(t){const{markup:e,bootData:r}=p(t);return{response:e,bootData:r}}}export{f as default};
